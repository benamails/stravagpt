"use strict";(()=>{var e={};e.id=932,e.ids=[932],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7790:e=>{e.exports=require("assert")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},4175:e=>{e.exports=require("tty")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},5837:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>v,staticGenerationAsyncStorage:()=>d});var a={};r.r(a),r.d(a,{GET:()=>u});var s=r(9303),o=r(8716),i=r(670),n=r(7070),c=r(5660),h=r(9178);async function u(e){try{let t=(0,h.G)(e);if(t)return t;let r=c.x.getAuthUrl();return n.NextResponse.json({success:!0,authUrl:r,message:"Use this URL to authenticate with Strava"})}catch(e){return console.error("Auth error:",e),n.NextResponse.json({success:!1,error:"Failed to generate auth URL"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/route",pathname:"/api/auth",filename:"route",bundlePath:"app/api/auth/route"},resolvedPagePath:"/Users/ben/Documents/strava-gpt-main/app/api/auth/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:v}=l,g="/api/auth/route";function f(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:d})}},9178:(e,t,r)=>{r.d(t,{G:()=>s});var a=r(7070);function s(e){let t=process.env.API_KEY;if(!t)return null;let r=e.headers.get("x-api-key");return r&&r===t?null:a.NextResponse.json({success:!1,error:"Invalid or missing API key. Include X-API-Key header."},{status:401})}},5660:(e,t,r)=>{r.d(t,{x:()=>o});var a=r(4263);class s{constructor(){if(this.baseUrl="https://www.strava.com/api/v3",this.clientId=process.env.STRAVA_CLIENT_ID,this.clientSecret=process.env.STRAVA_CLIENT_SECRET,this.redirectUri=process.env.STRAVA_REDIRECT_URI,!this.clientId||!this.clientSecret||!this.redirectUri)throw Error("Missing required Strava environment variables")}getAuthUrl(){let e=new URLSearchParams({client_id:this.clientId,redirect_uri:this.redirectUri,response_type:"code",scope:"read,activity:read_all,profile:read_all",approval_prompt:"force"});return`https://www.strava.com/oauth/authorize?${e.toString()}`}async exchangeCodeForToken(e){try{return(await a.Z.post("https://www.strava.com/oauth/token",{client_id:this.clientId,client_secret:this.clientSecret,code:e,grant_type:"authorization_code"})).data}catch(e){throw console.error("Error exchanging code for token:",e),Error("Failed to exchange authorization code for token")}}async refreshToken(e){try{return(await a.Z.post("https://www.strava.com/oauth/token",{client_id:this.clientId,client_secret:this.clientSecret,refresh_token:e,grant_type:"refresh_token"})).data}catch(e){throw console.error("Error refreshing token:",e),Error("Failed to refresh token")}}async getAthlete(e){try{return(await a.Z.get(`${this.baseUrl}/athlete`,{headers:{Authorization:`Bearer ${e}`}})).data}catch(e){throw console.error("Error fetching athlete:",e),Error("Failed to fetch athlete data")}}async getActivities(e,t=1,r=30,s){try{return(await a.Z.get(`${this.baseUrl}/athlete/activities`,{headers:{Authorization:`Bearer ${e}`},params:{page:t,per_page:r,...s?.before?{before:s.before}:{},...s?.after?{after:s.after}:{}}})).data}catch(e){throw console.error("Error fetching activities:",e),Error("Failed to fetch activities")}}async getActivity(e,t){try{return(await a.Z.get(`${this.baseUrl}/activities/${t}`,{headers:{Authorization:`Bearer ${e}`}})).data}catch(e){throw console.error("Error fetching activity:",e),Error("Failed to fetch activity")}}async getAthleteStats(e,t){try{return(await a.Z.get(`${this.baseUrl}/athletes/${t}/stats`,{headers:{Authorization:`Bearer ${e}`}})).data}catch(e){throw console.error("Error fetching athlete stats:",e),Error("Failed to fetch athlete stats")}}}let o=new s}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972,263],()=>r(5837));module.exports=a})();